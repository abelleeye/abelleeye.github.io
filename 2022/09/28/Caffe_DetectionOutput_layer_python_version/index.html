<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.f89e1344a600c2927d36.css" id="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}details{display:block}summary{display:list-item}[hidden],template{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e1e4e8}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::placeholder,textarea::placeholder{color:#a0aec0}button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;--text-opacity:1;color:#24292e;color:rgba(36,41,46,var(--text-opacity))}*{transition:width .2s ease-in}a{--text-opacity:1;color:#0366d6;color:rgba(3,102,214,var(--text-opacity))}a:hover{text-decoration:underline}.text-mono{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace!important}article{line-height:1.5;font-size:1rem;line-height:1.5rem;word-wrap:break-word;overflow-wrap:break-word}article>*{margin-bottom:1rem}article>h1,article>h2,article>h3,article>h4,article>h5,article>h6{font-weight:600;line-height:1.25;margin-top:1.5rem}article>:first-child{margin-top:0}article>h1{font-size:1.875rem;line-height:2.25rem}article>h1,article>h2{padding-bottom:.5rem;border-bottom-width:1px}article>h2{font-size:1.5rem;line-height:2rem}article>h3{font-size:1.25rem;line-height:1.75rem}article>h4{font-size:1.125rem;line-height:1.75rem}article>h5{font-size:1rem;line-height:1.5rem}article>h6{font-size:.875rem;line-height:1.25rem;--text-opacity:1;color:#6a737d;color:rgba(106,115,125,var(--text-opacity))}article a:link{--text-opacity:1;color:#0366d6;color:rgba(3,102,214,var(--text-opacity))}article ol,article ul{padding-left:1.5rem}article ul{list-style:disc}article ul ul{list-style:circle}article ul ul ul{list-style:square}article ol{list-style:decimal}article ol ol{list-style:lower-roman}article ol ol ol{list-style:lower-alpha}article hr{margin-top:1.5rem;margin-bottom:1.5rem;--bg-opacity:1;background-color:#e1e4e8;background-color:rgba(225,228,232,var(--bg-opacity));height:2px;content:" "}article img{max-width:100%}article>blockquote{padding-left:1rem;padding-right:1rem;--text-opacity:1;color:#6a737d;color:rgba(106,115,125,var(--text-opacity));border-left-width:4px}article pre{border-radius:.375rem;padding:1rem;font-size:.75rem;line-height:1rem;overflow:auto}article code{border-radius:.375rem;--bg-opacity:1;background-color:#f6f8fa;background-color:rgba(246,248,250,var(--bg-opacity));padding:1px .25rem;font-size:.875rem;line-height:1.25rem}article>table{display:block;width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}article>table tr{border-width:1px;--border-opacity:1;border-color:#e1e4e8;border-color:rgba(225,228,232,var(--border-opacity))}article>table tr:nth-child(2n){--bg-opacity:1;background-color:#f6f8fa;background-color:rgba(246,248,250,var(--bg-opacity))}article>table td,article>table th{padding:.5rem 1rem;border-width:1px;--border-opacity:1;border-color:#e1e4e8;border-color:rgba(225,228,232,var(--border-opacity))}article>table th{font-weight:600}article>kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}article .prism-code .token-line:last-child{height:0}._readme{line-height:1.5;font-size:1rem;line-height:1.5rem;word-wrap:break-word;overflow-wrap:break-word}._readme>*{margin-bottom:1rem}._readme>h1,._readme>h2,._readme>h3,._readme>h4,._readme>h5,._readme>h6{font-weight:600;line-height:1.25;margin-top:1.5rem}._readme>:first-child{margin-top:0}._readme>h1{font-size:1.875rem;line-height:2.25rem}._readme>h1,._readme>h2{padding-bottom:.5rem;border-bottom-width:1px}._readme>h2{font-size:1.5rem;line-height:2rem}._readme>h3{font-size:1.25rem;line-height:1.75rem}._readme>h4{font-size:1.125rem;line-height:1.75rem}._readme>h5{font-size:1rem;line-height:1.5rem}._readme>h6{font-size:.875rem;line-height:1.25rem;--text-opacity:1;color:#6a737d;color:rgba(106,115,125,var(--text-opacity))}._readme a:link{--text-opacity:1;color:#0366d6;color:rgba(3,102,214,var(--text-opacity))}._readme ol,._readme ul{padding-left:1.5rem}._readme ul{list-style:disc}._readme ul ul{list-style:circle}._readme ul ul ul{list-style:square}._readme ol{list-style:decimal}._readme ol ol{list-style:lower-roman}._readme ol ol ol{list-style:lower-alpha}._readme hr{margin-top:1.5rem;margin-bottom:1.5rem;--bg-opacity:1;background-color:#e1e4e8;background-color:rgba(225,228,232,var(--bg-opacity));height:2px;content:" "}._readme img{max-width:100%}._readme>blockquote{padding-left:1rem;padding-right:1rem;--text-opacity:1;color:#6a737d;color:rgba(106,115,125,var(--text-opacity));border-left-width:4px}._readme pre{border-radius:.375rem;padding:1rem;font-size:.75rem;line-height:1rem;overflow:auto}._readme code{border-radius:.375rem;--bg-opacity:1;background-color:#f6f8fa;background-color:rgba(246,248,250,var(--bg-opacity));padding:1px .25rem;font-size:.875rem;line-height:1.25rem}._readme>table{display:block;width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}._readme>table tr{border-width:1px;--border-opacity:1;border-color:#e1e4e8;border-color:rgba(225,228,232,var(--border-opacity))}._readme>table tr:nth-child(2n){--bg-opacity:1;background-color:#f6f8fa;background-color:rgba(246,248,250,var(--bg-opacity))}._readme>table td,._readme>table th{padding:.5rem 1rem;border-width:1px;--border-opacity:1;border-color:#e1e4e8;border-color:rgba(225,228,232,var(--border-opacity))}._readme>table th{font-weight:600}._readme>kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}._readme .prism-code .token-line:last-child{height:0}._readme p img{display:inline-block}.page-grid{width:100%;max-width:1280px;padding-left:1rem;padding-right:1rem;margin-left:auto;margin-right:auto;display:flex;flex-wrap:wrap}.topic-tag{--bg-opacity:1;background-color:#f1f8ff;background-color:rgba(241,248,255,var(--bg-opacity));border-radius:9999px;padding-left:.75rem;padding-right:.75rem;margin-bottom:.25rem;border-width:1px;--border-opacity:1;border-color:#fff;border-color:rgba(255,255,255,var(--border-opacity));font-size:.75rem;line-height:1rem;font-weight:500;line-height:1.5rem;display:inline-block}.topic-tag:hover{--bg-opacity:1;background-color:#def;background-color:rgba(221,238,255,var(--bg-opacity));text-decoration:none}.calendar-legend{display:inline-flex;justify-content:space-between;align-items:center;margin-left:.5rem;margin-right:.5rem;width:4rem}.calendar-legend li{content:" ";width:10px;height:10px;box-shadow:inset 0 0 0 1px rgba(27,31,35,.04);border-radius:.125rem;display:inline-block}.bg-white{--bg-opacity:1;background-color:#fff;background-color:rgba(255,255,255,var(--bg-opacity))}.bg-gray-100{--bg-opacity:1;background-color:#f6f8fa;background-color:rgba(246,248,250,var(--bg-opacity))}.bg-gray-120{--bg-opacity:1;background-color:#ebedf0;background-color:rgba(235,237,240,var(--bg-opacity))}.bg-gray-dark{--bg-opacity:1;background-color:#24292e;background-color:rgba(36,41,46,var(--bg-opacity))}.bg-yellow-light{--bg-opacity:1;background-color:#fff5b1;background-color:rgba(255,245,177,var(--bg-opacity))}.bg-green-superlight{--bg-opacity:1;background-color:#9be9a8;background-color:rgba(155,233,168,var(--bg-opacity))}.bg-green-light{--bg-opacity:1;background-color:#40c463;background-color:rgba(64,196,99,var(--bg-opacity))}.bg-green-medium{--bg-opacity:1;background-color:#30a14e;background-color:rgba(48,161,78,var(--bg-opacity))}.bg-green-dark{--bg-opacity:1;background-color:#216e39;background-color:rgba(33,110,57,var(--bg-opacity))}.bg-blue-100{--bg-opacity:1;background-color:#f1f8ff;background-color:rgba(241,248,255,var(--bg-opacity))}.bg-blue{--bg-opacity:1;background-color:#0366d6;background-color:rgba(3,102,214,var(--bg-opacity))}.hover\:bg-gray-100:hover{--bg-opacity:1;background-color:#f6f8fa;background-color:rgba(246,248,250,var(--bg-opacity))}.hover\:bg-blue:hover{--bg-opacity:1;background-color:#0366d6;background-color:rgba(3,102,214,var(--bg-opacity))}.border-collapse{border-collapse:collapse}.border-yellow{--border-opacity:1;border-color:#f9c513;border-color:rgba(249,197,19,var(--border-opacity))}.border-blue-light{--border-opacity:1;border-color:#c8e1ff;border-color:rgba(200,225,255,var(--border-opacity))}.rounded-md{border-radius:.375rem}.rounded-full{border-radius:9999px}.rounded-t-md{border-top-left-radius:.375rem;border-top-right-radius:.375rem}.border{border-width:1px}.border-t{border-top-width:1px}.border-b{border-bottom-width:1px}.cursor-pointer{cursor:pointer}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.grid{display:grid}.hidden{display:none}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-end{align-items:flex-end}.items-center{align-items:center}.self-end{align-self:flex-end}.justify-end{justify-content:flex-end}.justify-between{justify-content:space-between}.flex-grow{flex-grow:1}.order-1{order:1}.font-light{font-weight:300}.font-medium{font-weight:500}.font-semibold{font-weight:600}.h-0{height:0}.h-12{height:3rem}.h-auto{height:auto}.text-xs{font-size:.75rem;line-height:1rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem}.text-lg,.text-xl{line-height:1.75rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-11px{font-size:11px}.text-26px{font-size:26px}.leading-6{line-height:1.5rem}.leading-tight{line-height:1.25}.list-circle{list-style-type:circle}.my-2{margin-top:.5rem;margin-bottom:.5rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.my-4{margin-top:1rem;margin-bottom:1rem}.-mx-2{margin-left:-.5rem;margin-right:-.5rem}.-mx-4{margin-left:-1rem;margin-right:-1rem}.mr-0{margin-right:0}.mb-0{margin-bottom:0}.mt-1{margin-top:.25rem}.mr-1{margin-right:.25rem}.mb-1{margin-bottom:.25rem}.ml-1{margin-left:.25rem}.mt-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2{margin-bottom:.5rem}.ml-2{margin-left:.5rem}.ml-3{margin-left:.75rem}.mt-4{margin-top:1rem}.mr-4{margin-right:1rem}.mb-4{margin-bottom:1rem}.ml-5{margin-left:1.25rem}.mt-6{margin-top:1.5rem}.mb-6{margin-bottom:1.5rem}.mt-8{margin-top:2rem}.mb-8{margin-bottom:2rem}.mt-10{margin-top:2.5rem}.mt-3px{margin-top:3px}.-mr-2{margin-right:-.5rem}.min-h-screen{min-height:100vh}.opacity-50{opacity:.5}.opacity-75{opacity:.75}.overflow-hidden{overflow:hidden}.overflow-x-scroll{overflow-x:scroll}.p-2{padding:.5rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.px-1{padding-left:.25rem;padding-right:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-4{padding-left:1rem;padding-right:1rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.py-px{padding-top:1px;padding-bottom:1px}.px-2px{padding-left:2px;padding-right:2px}.pt-1{padding-top:.25rem}.pl-1{padding-left:.25rem}.pb-2{padding-bottom:.5rem}.pb-4{padding-bottom:1rem}.pt-6{padding-top:1.5rem}.pl-8{padding-left:2rem}.pt-10{padding-top:2.5rem}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.top-0{top:0}.left-1{left:.25rem}.-top-2px{top:-2px}.left-10px{left:10px}.top-74px{top:74px}.text-white{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity))}.text-gray-200{--text-opacity:1;color:#959da5;color:rgba(149,157,165,var(--text-opacity))}.text-gray-light{--text-opacity:1;color:#e1e4e8;color:rgba(225,228,232,var(--text-opacity))}.text-gray-medium{--text-opacity:1;color:#767676;color:rgba(118,118,118,var(--text-opacity))}.text-gray-main{--text-opacity:1;color:#586069;color:rgba(88,96,105,var(--text-opacity))}.text-gray-dark{--text-opacity:1;color:#24292e;color:rgba(36,41,46,var(--text-opacity))}.hover\:text-blue:hover,.text-blue{--text-opacity:1;color:#0366d6;color:rgba(3,102,214,var(--text-opacity))}.hover\:text-opacity-75:hover{--text-opacity:0.75}.hover\:no-underline:hover,.no-underline{text-decoration:none}.whitespace-no-wrap{white-space:nowrap}.w-24{width:6rem}.w-auto{width:auto}.w-2\/12{width:16.666667%}.w-10\/12{width:83.333333%}.w-full{width:100%}.w-screen{width:100vw}.z-10{z-index:10}.gap-4{grid-gap:1rem;gap:1rem}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.transform{--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y))}.transition{transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform}@keyframes spin{to{transform:rotate(1turn)}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes pulse{50%{opacity:.5}}@keyframes bounce{0%,to{transform:translateY(-25%);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;animation-timing-function:cubic-bezier(0,0,.2,1)}}@media (min-width:768px){.md\:rounded-b-md{border-bottom-right-radius:.375rem;border-bottom-left-radius:.375rem}.md\:border{border-width:1px}.md\:border-b-0{border-bottom-width:0}.md\:border-l{border-left-width:1px}.md\:block{display:block}.md\:flex{display:flex}.md\:hidden{display:none}.md\:flex-row{flex-direction:row}.md\:items-center{align-items:center}.md\:justify-start{justify-content:flex-start}.md\:justify-between{justify-content:space-between}.md\:order-1{order:1}.md\:h-60px{height:60px}.md\:text-xl{font-size:1.25rem;line-height:1.75rem}.md\:text-3xl{font-size:1.875rem;line-height:2.25rem}.md\:mx-0{margin-left:0;margin-right:0}.md\:mx-4{margin-left:1rem;margin-right:1rem}.md\:-mx-4{margin-left:-1rem;margin-right:-1rem}.md\:mr-0{margin-right:0}.md\:mb-0{margin-bottom:0}.md\:mr-2{margin-right:.5rem}.md\:mb-4{margin-bottom:1rem}.md\:mb-10{margin-bottom:2.5rem}.md\:ml-14{margin-left:3.5rem}.md\:-mt-8{margin-top:-2rem}.md\:overflow-hidden{overflow:hidden}.md\:py-0{padding-top:0;padding-bottom:0}.md\:py-4{padding-top:1rem;padding-bottom:1rem}.md\:px-4{padding-left:1rem;padding-right:1rem}.md\:px-6{padding-left:1.5rem;padding-right:1.5rem}.md\:px-8{padding-left:2rem;padding-right:2rem}.md\:pr-4{padding-right:1rem}.md\:pl-4{padding-left:1rem}.md\:-top-4px{top:-4px}.md\:left-8px{left:8px}.md\:w-1\/2{width:50%}.md\:w-2\/12{width:16.666667%}.md\:w-3\/12{width:25%}.md\:w-5\/12{width:41.666667%}.md\:w-9\/12{width:75%}.md\:w-10\/12{width:83.333333%}.md\:w-full{width:100%}.md\:z-20{z-index:20}.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}}@media (min-width:1280px){.xl\:items-center{align-items:center}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><title data-react-helmet="true">Caffe DetectionOutput Layer Python Version - Abel Lee</title><link data-react-helmet="true" rel="icon" type="image/svg+xml" href="https://github.githubassets.com/favicons/favicon.svg"/><link data-react-helmet="true" rel="canonical" href="https://www.abellee.cn/2022/09/28/Caffe_DetectionOutput_layer_python_version/"/><meta data-react-helmet="true" name="author" content="abelleeye"/><meta data-react-helmet="true" name="description" content=""/><meta data-react-helmet="true" name="keywords" content="Algorithm"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><style data-styled="" data-styled-version="5.3.8">.gOvYuo{color:#c6cbd1;}/*!sc*/
.gOvYuo:hover{color:#959da5;}/*!sc*/
data-styled.g5[id="sc-49bqba-0"]{content:"gOvYuo,"}/*!sc*/
.ewkxgH{position:absolute;z-index:2;width:14px;height:14px;color:var(--color-text-inverse);background-image:linear-gradient(#54a3ff,#006eed);background-clip:padding-box;border:2px solid #24292e;border-radius:50%;}/*!sc*/
data-styled.g7[id="sc-1n1400d-1"]{content:"ewkxgH,"}/*!sc*/
.cEsyA-d:before{content:' ';width:10px;height:10px;position:absolute;border-left:1px solid #c8e1ff;border-bottom:1px solid #c8e1ff;background:#f1f8ff;left:-5px;-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg);}/*!sc*/
data-styled.g11[id="sc-gf6yrx-0"]{content:"cEsyA-d,"}/*!sc*/
</style><link as="script" rel="preload" href="/webpack-runtime-b73b08d9011fcbf61db2.js"/><link as="script" rel="preload" href="/framework-303b5b995007c0324953.js"/><link as="script" rel="preload" href="/styles-4c7d46604086483aa196.js"/><link as="script" rel="preload" href="/app-e9a0804978caa9793f00.js"/><link as="script" rel="preload" href="/abba1267-4db10b0857c7c5274881.js"/><link as="script" rel="preload" href="/fa5f8105-cb81053d7202d517e9c0.js"/><link as="script" rel="preload" href="/e5908a55-3d0292d81ee122ce0f53.js"/><link as="script" rel="preload" href="/a490077e-d0b9734bbaaad323dc86.js"/><link as="script" rel="preload" href="/aa642b0a-84f2665e5b07251329ab.js"/><link as="script" rel="preload" href="/e2070dfd-b06a1c5dc488eaac3595.js"/><link as="script" rel="preload" href="/b3ead0f8-e70b62a53986d7cc5d98.js"/><link as="script" rel="preload" href="/43ccf438-9f3768ab58fc48b692cf.js"/><link as="script" rel="preload" href="/aacb0a1bb7a50c0bda0baac92d46406327a248f1-ea643fda3109e032a9b7.js"/><link as="script" rel="preload" href="/component---gatsby-theme-replica-src-templates-post-tsx-1d1f26811ac06ad09db0.js"/><link as="fetch" rel="preload" href="/page-data/2022/09/28/Caffe_DetectionOutput_layer_python_version/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2873555300.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3400548236.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/822196256.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="flex flex-col w-full min-h-screen"><div class="bg-gray-dark p-4 md:py-0 md:px-6"><div class="w-full flex justify-between md:justify-auto items-center md:h-60px"><div class="block md:hidden text-white text-3xl"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></div><a class="text-white" href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" size="32" height="32" width="32" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><div class="hidden md:flex items-center flex-grow px-4"><div class="flex ml-2 text-sm font-semibold"><a class="mx-2 py-4 text-white hover:no-underline hover:text-opacity-75" href="/"><span>Overview</span></a><a class="mx-2 py-4 text-white hover:no-underline hover:text-opacity-75" href="/archives"><span>Archives</span></a><a class="mx-2 py-4 text-white hover:no-underline hover:text-opacity-75" href="/categories"><span>Categories</span></a><a class="mx-2 py-4 text-white hover:no-underline hover:text-opacity-75" href="/tags"><span>Tags</span></a><a href="/atom.xml" class="mx-2 py-4 text-white hover:no-underline hover:text-opacity-75" target="_blank">RSS</a></div></div><ul class="flex items-center text-white font-semibold"><li class="relative"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="mr-0 md:mr-2 text-2xl md:text-xl" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M289.7 403c-6.1 0-11.4 4.2-12.7 10.2-1 4.5-2.7 8.2-5 10.9-1.3 1.5-5.1 5.9-16.1 5.9-11 0-14.8-4.5-16.1-5.9-2.3-2.7-4-6.4-5-10.9-1.3-6-6.6-10.2-12.7-10.2-8.4 0-14.5 7.8-12.7 15.9 5 22.3 21 37.1 46.5 37.1s41.5-14.7 46.5-37.1c1.8-8.1-4.4-15.9-12.7-15.9zM412 352.2c-15.4-20.3-45.7-32.2-45.7-123.1 0-93.3-41.2-130.8-79.6-139.8-3.6-.9-6.2-2.1-6.2-5.9v-2.9c0-13.3-10.8-24.6-24-24.6h-.6c-13.2 0-24 11.3-24 24.6v2.9c0 3.7-2.6 5-6.2 5.9-38.5 9.1-79.6 46.5-79.6 139.8 0 90.9-30.3 102.7-45.7 123.1-9.9 13.1-.5 31.8 15.9 31.8h280.1c16.1 0 25.4-18.8 15.6-31.8zm-39 5.8H139.8c-3.8 0-5.8-4.4-3.3-7.3 7-8 14.7-18.5 21-33.4 9.6-22.6 14.3-51.5 14.3-88.2 0-37.3 7-66.5 20.9-86.8 12.4-18.2 27.9-25.1 38.7-27.6 8.4-2 14.4-5.8 18.6-10.5 3.2-3.6 8.7-3.8 11.9-.2 5.1 5.7 12 9.1 18.8 10.7 10.8 2.5 26.3 9.4 38.7 27.6 13.9 20.3 20.9 49.5 20.9 86.8 0 36.7 4.7 65.6 14.3 88.2 6.5 15.2 14.4 25.9 21.5 33.9 2.2 2.7.4 6.8-3.1 6.8z"></path></svg><div class="sc-1n1400d-1 ewkxgH -top-2px left-10px md:left-8px md:-top-4px"></div></li><li class="hidden md:flex mr-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="text-xl relative left-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M368.5 240H272v-96.5c0-8.8-7.2-16-16-16s-16 7.2-16 16V240h-96.5c-8.8 0-16 7.2-16 16 0 4.4 1.8 8.4 4.7 11.3 2.9 2.9 6.9 4.7 11.3 4.7H240v96.5c0 4.4 1.8 8.4 4.7 11.3 2.9 2.9 6.9 4.7 11.3 4.7 8.8 0 16-7.2 16-16V272h96.5c8.8 0 16-7.2 16-16s-7.2-16-16-16z"></path></svg><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-xl" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g><path fill="none" d="M0 0h24v24H0z"></path><path d="M12 14l-4-4h8z"></path></g></svg></li><li class="hidden md:flex -mr-2"><img src="https://s2.loli.net/2023/03/09/X5DGjoBMlEwJKHc.jpg" class="rounded-full" width="20"/><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-xl" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g><path fill="none" d="M0 0h24v24H0z"></path><path d="M12 14l-4-4h8z"></path></g></svg></li></ul></div><div class="h-0 w-full font-semibold overflow-hidden"><a class="py-2 text-white hover:no-underline block border-t-fade-white15" href="/"><span>Overview</span></a><a class="py-2 text-white hover:no-underline block border-t-fade-white15" href="/archives"><span>Archives</span></a><a class="py-2 text-white hover:no-underline block border-t-fade-white15" href="/categories"><span>Categories</span></a><a class="py-2 text-white hover:no-underline block border-t-fade-white15" href="/tags"><span>Tags</span></a><a href="/atom.xml" class="py-2 text-white hover:no-underline block border-t-fade-white15" target="_blank">RSS</a><a class="py-2 text-white hover:no-underline flex md:hidden items-center border-t-fade-white15" href="/"><img src="https://s2.loli.net/2023/03/09/X5DGjoBMlEwJKHc.jpg" class="rounded-full mr-2" width="20"/>abelleeye</a></div></div><div class="page-grid mt-4 md:px-8"><div class="w-full mb-4"><h1 class="text-2xl md:text-3xl mb-2">Caffe DetectionOutput Layer Python Version<!-- --> <span class="text-gray-200">#<!-- -->26</span></h1><div class="text-sm text-gray-main border-b md:mb-4 pb-4">Posted <!-- -->5 months ago<!-- --> Â· <!-- --> mins reading</div></div><div class="w-full md:w-9/12 md:pr-4 md:border-b-0 mb-4"><div class="relative"><img src="https://s2.loli.net/2023/03/09/X5DGjoBMlEwJKHc.jpg" class="hidden md:block border rounded-full absolute" width="40"/><div class="md:ml-14"><div class="sc-gf6yrx-0 cEsyA-d hidden md:flex items-center justify-between text-xs relative bg-blue-100 text-gray-main
      border md:border-b-0 rounded-t-md border-blue-light py-2 px-4"><div class="leading-6"><img src="https://s2.loli.net/2023/03/09/X5DGjoBMlEwJKHc.jpg" class="inline md:hidden rounded-full mr-2" width="24"/><strong>abelleeye</strong> posted on<!-- --> <time dateTime="2022-09-28T16:28:00.000Z" title="2022-09-28T16:28:00.000Z">Sep 28</time></div><div class="flex items-center"><span class="border border-blue-light rounded-full px-2 py-px hidden md:block"><strong>Author</strong></span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" size="18" class="hidden md:block md:mx-4" height="18" width="18" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.111 2.18a7 7 0 1 1 7.778 11.64A7 7 0 0 1 4.11 2.18zm.556 10.809a6 6 0 1 0 6.666-9.978 6 6 0 0 0-6.666 9.978zM6.5 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm5 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM8 11a3 3 0 0 1-2.65-1.58l-.87.48a4 4 0 0 0 7.12-.16l-.9-.43A3 3 0 0 1 8 11z"></path></svg><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" size="18" height="18" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M4 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm5 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm5 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path></svg></div></div><article class="border-b md:border md:rounded-b-md md:px-8 md:py-4"><div class="relative"><div class="absolute text-gray-dark text-xs px-2 py-px right-0 top-0 bg-gray-light rounded-bl-md rounded-tr-md">python</div><pre class="prism-code language-python" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cv2</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> caffe</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> math</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> functools</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> time</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">NormalizedBBox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> xmin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ymin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> xmax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ymax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> xmin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ymin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> xmax</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ymax</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">BBoxSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        bbox</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># type: NormalizedBBox</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        normalized</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> normalized</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> width </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> height</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">width </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">height </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ClipBBox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        bbox  </span><span class="token comment" style="color:#999988;font-style:italic"># type: NormalizedBBox</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BBoxSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># TODO bbox.difficult = difficult</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DecodeBBox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_bbox</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prior_variance</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> code_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> variance_encoded_in_target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> clip_bbox</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> decode_bbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> code_type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> variance_encoded_in_target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> code_type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        prior_width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> prior_width </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        prior_height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> prior_height </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        prior_center_x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        prior_center_y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> variance_encoded_in_target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox_center_x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_width </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> prior_center_x</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox_center_y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_height </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> prior_center_y</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox_width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_width</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox_height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_height</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox_center_x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_width </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> prior_center_x</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox_center_y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_height </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> prior_center_y</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox_width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_width</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox_height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_height</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> decode_bbox_center_x </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> decode_bbox_width </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> decode_bbox_center_y </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> decode_bbox_height </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> decode_bbox_center_x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> decode_bbox_width </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> decode_bbox_center_y </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> decode_bbox_height </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> code_type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        prior_width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> prior_width </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        prior_height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> prior_height </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> variance_encoded_in_target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_width</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_height</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_width</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_height</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_width</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_height</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_width</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> prior_height</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Unknown LocLossType.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    decode_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BBoxSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">decode_bbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> clip_bbox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        ClipBBox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">decode_bbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">first_compare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetMaxScoreIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scores</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> threshold</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> top_k</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    score_index_vec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scores</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> scores</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            score_index_vec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scores</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    score_index_vec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">functools</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cmp_to_key</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">first_compare</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reverse</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> top_k </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">score_index_vec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        score_index_vec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> score_index_vec</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> top_k</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> score_index_vec</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">IntersectBBox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bbox2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> intersect_bbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> bbox2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> bbox1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> bbox2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> bbox1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> bbox2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> bbox1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> bbox2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> bbox1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bbox2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bbox2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bbox2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bbox2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">JaccardOverlap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bbox2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> normalized</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    intersect_bbox </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NormalizedBBox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    IntersectBBox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bbox2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> intersect_bbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> normalized</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        intersect_width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        intersect_height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        intersect_width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        intersect_height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> intersect_bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> intersect_width </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> intersect_height </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        intersect_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> intersect_width </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> intersect_height</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        bbox1_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BBoxSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        bbox2_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BBoxSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> intersect_size </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox1_size </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> bbox2_size </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> intersect_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ApplyNMSFast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        bboxes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        scores</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        score_threshold</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        nms_threshold</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        eta</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        _top_k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        indices</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bboxes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scores</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    score_index_vec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> GetMaxScoreIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scores</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> score_threshold</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _top_k</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    adaptive_threshold </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> nms_threshold</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> score_index </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> score_index_vec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        idx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> score_index</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        keep </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> k </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">indices</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> keep</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                kept_idx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> indices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">k</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                overlap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> JaccardOverlap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bboxes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bboxes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">kept_idx</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                keep </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> overlap </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> adaptive_threshold</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> keep</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            indices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">idx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> keep </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> eta </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> adaptive_threshold </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            adaptive_threshold </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> eta</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DecodeBBoxes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_bboxes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prior_variances</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> code_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> variance_encoded_in_target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> clip_bbox</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bboxes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                 decode_bboxes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_bboxes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variances</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_bboxes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bboxes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    num_bboxes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_bboxes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> num_bboxes </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_variances</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_bboxes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        decode_bbox </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NormalizedBBox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        DecodeBBox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_bboxes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prior_variances</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> code_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                   variance_encoded_in_target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> clip_bbox</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bboxes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> decode_bbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        decode_bboxes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">decode_bbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">detection_out</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mreshape_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mbox_conf_flatten</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reshape_priorbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    background_label_id_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    confidence_threshold_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.3</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    keep_top_k_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    nms_threshold_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.45</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_k_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    eta_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    num_classes_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">81</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    share_location_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    code_type_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 0: CORNER, 1:CENTER_SIZE, 2:CORNER_SIZE</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    variance_encoded_in_target_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    confidence_threshold_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> confidence_threshold_ </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> confidence_threshold_ </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3.40282347e+38</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_k_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> top_k_ </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> top_k_ </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    num_priors_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reshape_priorbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    num_loc_classes_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> share_location_ </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> num_classes_</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mreshape_loc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Retrieve all location predictions.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    loc_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mreshape_loc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flatten</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    num_preds_per_class </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num_priors_</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    num_loc_classes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num_loc_classes_</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    share_location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> share_location_</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># GetLocPredictions Retrieve all location predictions.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    all_loc_preds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        label_bbox </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        offset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num_preds_per_class </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> num_loc_classes </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> n</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> p </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_preds_per_class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            start_idx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> offset </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> num_loc_classes </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> c </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_loc_classes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                label </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> share_location </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> c</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> label </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> label_bbox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    label_bbox</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                label_bbox</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NormalizedBBox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    loc_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_idx </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    loc_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_idx </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    loc_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_idx </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    loc_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_idx </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        all_loc_preds</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">label_bbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># GetConfidenceScores Retrieve all confidences.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    all_conf_scores </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    conf_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mbox_conf_flatten</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flatten</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    num_classes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num_classes_</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        offset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num_preds_per_class </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> num_classes </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> n</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        label_scores </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> p </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_preds_per_class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            start_idx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> offset </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> num_classes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> c </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_classes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> c </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> label_scores</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    label_scores</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                label_scores</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_idx </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        all_conf_scores</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">label_scores</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># GetPriorBBoxes</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Retrieve all prior bboxes. It is same within a batch since we assume all</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># images in a batch are of same dimension.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    prior_bboxes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    prior_variances </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    prior_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reshape_priorbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flatten</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    num_priors </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num_priors_</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_priors</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        start_idx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        bbox </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NormalizedBBox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_idx</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_idx </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_idx </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_idx </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        bbox_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BBoxSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bbox_size</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        prior_bboxes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_priors</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        start_idx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_priors </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        var </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> j </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            var</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_idx </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        prior_variances</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">var</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># DecodeBBoxesAll</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    all_decode_bboxes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clip_bbox </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    all_loc_preds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> all_loc_preds</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    prior_bboxes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_bboxes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    prior_variances </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prior_variances</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    share_location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> share_location_</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    num_loc_classes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num_loc_classes_</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    background_label_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> background_label_id_</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    code_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> code_type_</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    variance_encoded_in_target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> variance_encoded_in_target_</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clip </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> clip_bbox</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">all_loc_preds</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        decode_bboxes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> c </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_loc_classes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            label </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> share_location </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> c</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> label </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> background_label_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> label </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> all_loc_preds</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Could not find location predictions for label &quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            decode_bboxes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            label_loc_preds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> all_loc_preds</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            DecodeBBoxes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prior_bboxes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prior_variances</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                         code_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> variance_encoded_in_target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> clip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                         label_loc_preds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> decode_bboxes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        all_decode_bboxes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">decode_bboxes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    num_kept </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    all_indices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        decode_bboxes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> all_decode_bboxes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        conf_scores </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> all_conf_scores</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        num_det </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        indices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> c </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_classes_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> background_label_id_</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> c </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> conf_scores</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Could not find confidence predictions for label &quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> c </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> indices</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                indices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            scores </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conf_scores</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            label </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> share_location_ </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> c</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> label </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> decode_bboxes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Could not find location predictions for label &quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            bboxes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> decode_bboxes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            ApplyNMSFast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bboxes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> scores</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> confidence_threshold_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nms_threshold_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eta_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                         top_k_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> indices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            num_det </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">indices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> keep_top_k_ </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> num_det </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> keep_top_k_</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            score_index_pairs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> label </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> indices</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                label_indices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> indices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> label </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> conf_scores</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Could not find location predictions for &quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                scores </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conf_scores</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> j </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">label_indices</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    idx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> label_indices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> idx </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scores</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    score_index_pairs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scores</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> idx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            score_index_pairs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">functools</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cmp_to_key</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">first_compare</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reverse</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            score_index_pairs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> score_index_pairs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> top_k_</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            new_indices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> j </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">score_index_pairs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                label </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> score_index_pairs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                idx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> score_index_pairs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> label </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> new_indices</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    new_indices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                new_indices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">idx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            all_indices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">new_indices</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            num_kept </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> keep_top_k_</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            all_indices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">indices</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            num_kept </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> num_det</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_shape </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> num_kept</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">tuple</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">top_shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dtype</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;float32&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> num_kept </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Couldn&#x27;t find any detections&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        top_shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        top_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">tuple</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">top_shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        top_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            top_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> n</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_data_shape </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> top_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_data_flatten </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> top_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flatten</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    keep_count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        conf_scores </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> all_conf_scores</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        decode_bboxes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> all_decode_bboxes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">all_indices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> label </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> all_indices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> label </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> conf_scores</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Could not find confidence predictions for &quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            scores </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conf_scores</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            loc_label </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> share_location_ </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> label</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> loc_label </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> decode_bboxes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Could not find location predictions for &quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> loc_label</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            bboxes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> decode_bboxes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">loc_label</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            indices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> all_indices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            keep_count </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">indices</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> j </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">indices</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                idx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> indices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                top_data_flatten</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> n</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                top_data_flatten</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> label</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                top_data_flatten</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> scores</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                bbox </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bboxes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                top_data_flatten</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                top_data_flatten</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymin</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                top_data_flatten</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xmax</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                top_data_flatten</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bbox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ymax</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                count </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> top_data_flatten</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">top_data_shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> top_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> keep_count</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    coco_net </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> caffe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Net</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;VGG_coco_SSD_512x512_iter_360000_without_detection_output.prototxt&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Cut Detection Output Layer</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                         </span><span class="token string" style="color:#e3116c">&#x27;VGG_coco_SSD_512x512_iter_360000_without_detection_output.caffemodel&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> caffe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">TEST</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    image_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ssd.jpg&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    img </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    resized_img </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">512</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    input_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">asarray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resized_img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    input_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> input_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transpose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    input_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> input_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    input_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> input_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">astype</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;float32&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    blue_mean </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">104.0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    green_mean </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">117.0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    red_mean </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123.0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    input_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> blue_mean</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    input_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> green_mean</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    input_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> red_mean</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    coco_net</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">blobs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;data&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> input_data</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    output </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> coco_net</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">forward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    mreshape_loc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> output</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;mreshape_loc&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    mbox_conf_flatten </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> output</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;mbox_conf_flatten&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    reshape_priorbox </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> output</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;reshape_priorbox&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    detections</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> keep_count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detection_out</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mreshape_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mbox_conf_flatten</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reshape_priorbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;{:.2f}&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">end </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> start</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># parse the output</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    det_label </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detections</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    det_conf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detections</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    det_xmin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detections</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    det_ymin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detections</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    det_xmax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detections</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    det_ymax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detections</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># get topN detections</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_k </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> keep_count</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    topk_indexes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> det_conf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argsort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">top_k</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_conf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> det_conf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">topk_indexes</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_label_indexes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> det_label</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">topk_indexes</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_xmin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> det_xmin</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">topk_indexes</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_ymin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> det_ymin</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">topk_indexes</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_xmax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> det_xmax</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">topk_indexes</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    top_ymax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> det_ymax</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">topk_indexes</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">top_conf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        label </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">det_label</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        xmin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">top_xmin</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        ymin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">top_ymin</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        xmax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">top_xmax</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        ymax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">top_ymax</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        score </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> top_conf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> score</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> xmin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ymin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> xmax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ymax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rectangle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resized_img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">xmin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ymin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">xmax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ymax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imwrite</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ssd_out_cut.jpg&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resized_img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div></article></div></div><div class="flex py-2 text-xs flex-wrap justify-between items-center ml:0 md:ml-14"><div><span class="mr-1 text-gray-medium">â</span><a href="/2022/05/05/ä½æ¶ä½¿ç¨å¼ç¨åæ°/"> <!-- -->ä½æ¶ä½¿ç¨å¼ç¨åæ°</a></div></div></div><div class="w-full md:w-3/12 md:pl-4"><div class="pb-4 border-b"><h2 class="mb-4 font-medium">About</h2><a class="flex items-center text-gray-medium hover:text-blue hover:no-underline mb-4" href="/categories/algorithm"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M527.9 224H480v-48c0-26.5-21.5-48-48-48H272l-64-64H48C21.5 64 0 85.5 0 112v288c0 26.5 21.5 48 48 48h400c16.5 0 31.9-8.5 40.7-22.6l79.9-128c20-31.9-3-73.4-40.7-73.4zM48 118c0-3.3 2.7-6 6-6h134.1l64 64H426c3.3 0 6 2.7 6 6v42H152c-16.8 0-32.4 8.8-41.1 23.2L48 351.4zm400 282H72l77.2-128H528z"></path></svg><span class="ml-3 text-sm">Algorithm</span></a><div><a class="topic-tag" href="/tags/algorithm">Algorithm<!-- --> <span class="font-semibold"></span></a></div></div></div></div><footer class="border-t mt-10 pt-10 mb-4 md:mb-10"><div class="page-grid flex flex-wrap items-center md:justify-between text-xs md:flex-row"><ul class="flex flex-wrap justify-between w-full md:w-5/12 md:justify-start -mx-2 md:-mx-4"><li class="mx-2 md:mx-4">Â© <!-- -->2023<!-- --> <!-- -->abelleeye</li><li>built 1580 days</li><li class="mx-2 md:mx-4"><a href="https://www.abellee.cn" target="_blank">Home</a></li><li class="mx-2 md:mx-4"><a href="https://github.com/abelleeye" target="_blank">Github</a></li></ul><div class="hidden md:block md:2/12"><a class="sc-49bqba-0 gOvYuo" href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" size="32" height="32" width="32" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></div></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-52574938-2"></script><script>
      
      function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-52574938-2',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
      if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-52574938-2', {"anonymize_ip":true,"cookie_expires":0,"send_page_view":false});
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2022/09/28/Caffe_DetectionOutput_layer_python_version/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-1f0aaa06f71fd592e7ae.js"],"app":["/app-e9a0804978caa9793f00.js"],"component---gatsby-theme-replica-src-templates-archive-tsx":["/component---gatsby-theme-replica-src-templates-archive-tsx-1aaf17d66d7ad58110e3.js"],"component---gatsby-theme-replica-src-templates-categories-tsx":["/component---gatsby-theme-replica-src-templates-categories-tsx-75d164978554b1074e08.js"],"component---gatsby-theme-replica-src-templates-category-tsx":["/component---gatsby-theme-replica-src-templates-category-tsx-57bdb18c952a974b2e65.js"],"component---gatsby-theme-replica-src-templates-home-tsx":["/component---gatsby-theme-replica-src-templates-home-tsx-82a7c48eb52ccff1ad43.js"],"component---gatsby-theme-replica-src-templates-post-tsx":["/component---gatsby-theme-replica-src-templates-post-tsx-1d1f26811ac06ad09db0.js"],"component---gatsby-theme-replica-src-templates-tag-tsx":["/component---gatsby-theme-replica-src-templates-tag-tsx-c273715bccb907a9e576.js"],"component---gatsby-theme-replica-src-templates-tags-tsx":["/component---gatsby-theme-replica-src-templates-tags-tsx-c2197fb5090e959eafc3.js"],"component---src-pages-about-js":["/component---src-pages-about-js-bafb49cf5b05e776558f.js"]};/*]]>*/</script><script src="/polyfill-1f0aaa06f71fd592e7ae.js" nomodule=""></script><script src="/component---gatsby-theme-replica-src-templates-post-tsx-1d1f26811ac06ad09db0.js" async=""></script><script src="/aacb0a1bb7a50c0bda0baac92d46406327a248f1-ea643fda3109e032a9b7.js" async=""></script><script src="/43ccf438-9f3768ab58fc48b692cf.js" async=""></script><script src="/b3ead0f8-e70b62a53986d7cc5d98.js" async=""></script><script src="/e2070dfd-b06a1c5dc488eaac3595.js" async=""></script><script src="/aa642b0a-84f2665e5b07251329ab.js" async=""></script><script src="/a490077e-d0b9734bbaaad323dc86.js" async=""></script><script src="/e5908a55-3d0292d81ee122ce0f53.js" async=""></script><script src="/fa5f8105-cb81053d7202d517e9c0.js" async=""></script><script src="/abba1267-4db10b0857c7c5274881.js" async=""></script><script src="/app-e9a0804978caa9793f00.js" async=""></script><script src="/styles-4c7d46604086483aa196.js" async=""></script><script src="/framework-303b5b995007c0324953.js" async=""></script><script src="/webpack-runtime-b73b08d9011fcbf61db2.js" async=""></script></body></html>